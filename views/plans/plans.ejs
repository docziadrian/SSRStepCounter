<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StepSetGo - Személyre Szabott Edzésterv Generátor</title>
  <link rel="stylesheet" href="../../src/css/landing.css" />
  <link rel="stylesheet" href="../../src/css/output.css" />
  <style>
    .glass-card {
      background: rgba(59, 85, 122, 0.212);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(118, 171, 174, 0.2);
    }
    .glass-card-light {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
    .glass-input {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(118, 171, 174, 0.3);
      transition: all 0.3s ease;
    }
    .glass-input:focus {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(118, 171, 174, 0.6);
      box-shadow: 0 0 20px rgba(118, 171, 174, 0.2);
    }
    .equipment-chip {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .equipment-chip:hover {
      transform: scale(1.02);
    }
    .equipment-chip.selected {
      background: rgba(118, 171, 174, 0.4);
      border-color: #76ABAE;
      box-shadow: 0 0 15px rgba(118, 171, 174, 0.3);
    }
    .option-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .option-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    .option-card.selected {
      background: rgba(118, 171, 174, 0.3);
      border-color: #76ABAE;
    }
    .step-indicator {
      transition: all 0.3s ease;
    }
    .step-indicator.active {
      background: #76ABAE;
      color: white;
    }
    .step-indicator.completed {
      background: #4CAF50;
      color: white;
    }
    .form-step {
      display: none;
      animation: fadeIn 0.4s ease;
    }
    .form-step.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading-pulse {
      animation: pulse 1.5s infinite;
    }
    .generating-overlay {
      position: fixed;
      inset: 0;
      background: rgba(34, 40, 49, 0.95);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .generating-overlay.active {
      display: flex;
    }
    .plan-card {
      transition: all 0.3s ease;
    }
    .plan-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
    .range-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: rgba(118, 171, 174, 0.3);
      outline: none;
    }
    .range-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #76ABAE;
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    .category-section {
      border-left: 3px solid #76ABAE;
      padding-left: 1rem;
      margin-bottom: 1.5rem;
    }
  </style>
</head>

<body class="bg-[#222831] min-h-screen">
<%- include('../navbar/navbar') %>

<!-- Háttér -->
<section class="fixed inset-0 w-full h-full -z-10 bg-[#31363F]">
  <div class="absolute inset-0">
    <img src="../src/images/hatter.png" alt="Background" class="w-full h-full object-cover hidden xl:block" />
    <img src="../src/images/hattermobile.png" alt="Background" class="w-full h-full object-cover xl:hidden" />
    <div class="absolute inset-0 hero-gradient bg-pattern"></div>
  </div>
</section>

<!-- Generálás overlay -->
<div class="generating-overlay" id="generatingOverlay">
  <div class="text-center">
    <div class="relative w-24 h-24 mx-auto mb-6">
      <div class="absolute inset-0 rounded-full border-4 border-[#76ABAE]/20"></div>
      <div class="absolute inset-0 rounded-full border-4 border-transparent border-t-[#76ABAE] animate-spin"></div>
      <div class="absolute inset-4 rounded-full bg-[#76ABAE]/20 flex items-center justify-center">
        <svg class="w-8 h-8 text-[#76ABAE] loading-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
      </div>
    </div>
    <h3 class="text-2xl font-bold text-white mb-2">Edzésterved készül...</h3>
    <p class="text-[#EEEEEE]/70 text-sm max-w-md">
      A mesterséges intelligencia éppen összeállítja a személyre szabott edzéstervedet. 
      Ez általában 10-30 másodpercet vesz igénybe.
    </p>
    <div class="mt-6 flex items-center justify-center gap-2">
      <div class="w-2 h-2 rounded-full bg-[#76ABAE] animate-bounce" style="animation-delay: 0s;"></div>
      <div class="w-2 h-2 rounded-full bg-[#76ABAE] animate-bounce" style="animation-delay: 0.1s;"></div>
      <div class="w-2 h-2 rounded-full bg-[#76ABAE] animate-bounce" style="animation-delay: 0.2s;"></div>
    </div>
  </div>
</div>

<main class="relative min-h-screen pt-8 pb-32 px-4 sm:px-6 lg:px-8">
  <div class="max-w-6xl mx-auto">
    
    <!-- Fejléc -->
    <div class="text-center mb-8">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-3 inline-flex items-center justify-center gap-3">
        <svg class="w-10 h-10 sm:w-12 sm:h-12 text-[#76ABAE]" fill="currentColor" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z" /></svg>
        Személyre Szabott Edzésterv
      </h1>
      <p class="text-[#EEEEEE]/70 text-sm sm:text-base max-w-2xl mx-auto">
        A mesterséges intelligencia segítségével készítünk neked egy tökéletes, 
        többhetes edzéstervet a céljaid és lehetőségeid alapján.
      </p>
      <% if (avgSteps) { %>
      <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-full glass-card-light">
        <svg class="w-5 h-5 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
        </svg>
        <span class="text-[#EEEEEE]/80 text-sm">
          Átlagos napi lépésszámod: <strong class="text-[#76ABAE]"><%= avgSteps.toLocaleString('hu-HU') %></strong>
        </span>
      </div>
      <% } %>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Bal oldal: Generátor űrlap -->
      <div class="lg:col-span-2">
        <div class="glass-card rounded-2xl p-6 sm:p-8">
          
          <!-- Lépésjelző -->
          <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
              <div class="step-indicator active w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm border-2 border-[#76ABAE]/30" id="step1Indicator">1</div>
              <div class="h-1 w-8 sm:w-16 bg-[#76ABAE]/20 rounded" id="step1Line"></div>
              <div class="step-indicator w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm border-2 border-[#76ABAE]/30 text-[#EEEEEE]/50" id="step2Indicator">2</div>
              <div class="h-1 w-8 sm:w-16 bg-[#76ABAE]/20 rounded" id="step2Line"></div>
              <div class="step-indicator w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm border-2 border-[#76ABAE]/30 text-[#EEEEEE]/50" id="step3Indicator">3</div>
            </div>
            <span class="text-[#EEEEEE]/50 text-sm" id="stepLabel">1/3 - Cél kiválasztása</span>
          </div>

          <form id="workoutForm">
            
            <!-- 1. LÉPÉS: Cél és szint -->
            <div class="form-step active" id="step1">
              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                Mi a célod?
              </h2>
              
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-8">
                <% goals.forEach((goal, index) => { %>
                <label class="option-card glass-card-light rounded-xl p-4 text-center cursor-pointer block">
                  <input type="radio" name="goalId" value="<%= goal.id %>" class="hidden" <%= index === 0 ? 'checked' : '' %> />
                  <div class="text-3xl mb-2 flex justify-center">
                    <% if (goal.name === 'Fogyás') { %>
                    <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg>
                    <% } else if (goal.name === 'Izomépítés') { %>
                    <svg class="w-8 h-8 text-red-400" fill="currentColor" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z" /></svg>
                    <% } else if (goal.name === 'Állóképesség') { %>
                    <svg class="w-8 h-8 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                    <% } else if (goal.name === 'Erőnövelés') { %>
                    <svg class="w-8 h-8 text-orange-400" fill="currentColor" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z" /></svg>
                    <% } else if (goal.name === 'Rugalmasság') { %>
                    <svg class="w-8 h-8 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                    <% } else if (goal.name === 'Általános fittség') { %>
                    <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>
                    <% } else if (goal.name === 'Rehabilitáció') { %>
                    <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                    <% } else { %>
                    <svg class="w-8 h-8 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" /></svg>
                    <% } %>
                  </div>
                  <span class="text-white font-semibold text-sm"><%= goal.name %></span>
                </label>
                <% }); %>
              </div>

              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                Milyen az edzettségi szinted?
              </h2>
              
              <div class="grid grid-cols-1 sm:grid-cols-5 gap-3 mb-8">
                <% fitnessLevels.forEach((level, index) => { %>
                <label class="option-card glass-card-light rounded-xl p-4 text-center cursor-pointer block">
                  <input type="radio" name="fitnessLevelId" value="<%= level.id %>" class="hidden" <%= index === 0 ? 'checked' : '' %> />
                  <div class="text-2xl mb-1 flex justify-center">
                    <% if (index === 0) { %>
                    <svg class="w-7 h-7 text-green-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
                    <% } else if (index === 1) { %>
                    <svg class="w-7 h-7 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                    <% } else if (index === 2) { %>
                    <svg class="w-7 h-7 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <% } else if (index === 3) { %>
                    <svg class="w-7 h-7 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" /></svg>
                    <% } else { %>
                    <svg class="w-7 h-7 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                    <% } %>
                  </div>
                  <span class="text-white font-semibold text-xs sm:text-sm"><%= level.name %></span>
                </label>
                <% }); %>
              </div>

              <button type="button" onclick="nextStep(2)" class="w-full py-4 rounded-xl bg-[#76ABAE] hover:bg-[#76ABAE]/90 text-white font-bold text-lg transition-all flex items-center justify-center gap-2">
                Tovább
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </button>
            </div>

            <!-- 2. LÉPÉS: Helyszín és eszközök -->
            <div class="form-step" id="step2">
              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                Hol fogsz edzeni?
              </h2>
              
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-8">
                <% locations.forEach((location, index) => { %>
                <label class="option-card glass-card-light rounded-xl p-4 text-center cursor-pointer block">
                  <input type="radio" name="locationId" value="<%= location.id %>" class="hidden" <%= index === 0 ? 'checked' : '' %> />
                  <div class="text-3xl mb-2 flex justify-center">
                    <% if (location.name === 'Otthon') { %>
                    <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                    <% } else if (location.name === 'Konditerem') { %>
                    <svg class="w-8 h-8 text-red-400" fill="currentColor" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z" /></svg>
                    <% } else if (location.name === 'Szabadtér') { %>
                    <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>
                    <% } else if (location.name === 'Iroda') { %>
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    <% } else if (location.name === 'Úszómedence') { %>
                    <svg class="w-8 h-8 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5" /></svg>
                    <% } else { %>
                    <svg class="w-8 h-8 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    <% } %>
                  </div>
                  <span class="text-white font-semibold text-sm"><%= location.name %></span>
                </label>
                <% }); %>
              </div>

              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-[#76ABAE]" fill="currentColor" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z" /></svg>
                Milyen eszközeid vannak?
                <span class="text-xs text-[#EEEEEE]/50 font-normal">(több is választható)</span>
              </h2>
              
              <% Object.keys(equipmentByCategory).forEach(category => { %>
              <div class="category-section">
                <h3 class="text-sm font-semibold text-[#76ABAE] mb-3"><%= categoryNames[category] || category %></h3>
                <div class="flex flex-wrap gap-2 mb-4">
                  <% equipmentByCategory[category].forEach(eq => { %>
                  <label class="equipment-chip glass-card-light rounded-full px-4 py-2 text-sm text-white cursor-pointer block border border-transparent <%= eq.is_basic ? 'selected' : '' %>">
                    <input type="checkbox" name="equipmentIds[]" value="<%= eq.id %>" class="hidden" <%= eq.is_basic ? 'checked' : '' %> />
                    <%= eq.name %>
                  </label>
                  <% }); %>
                </div>
              </div>
              <% }); %>

              <div class="flex gap-3 mt-6">
                <button type="button" onclick="prevStep(1)" class="flex-1 py-4 rounded-xl glass-card-light text-white font-bold text-lg transition-all flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                  </svg>
                  Vissza
                </button>
                <button type="button" onclick="nextStep(3)" class="flex-1 py-4 rounded-xl bg-[#76ABAE] hover:bg-[#76ABAE]/90 text-white font-bold text-lg transition-all flex items-center justify-center gap-2">
                  Tovább
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- 3. LÉPÉS: Időkeret és részletek -->
            <div class="form-step" id="step3">
              <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                Időkeret beállítása
              </h2>
              
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
                <div>
                  <label class="block text-[#EEEEEE]/80 text-sm font-semibold mb-3">Edzésterv hossza</label>
                  <div class="glass-card-light rounded-xl p-4">
                    <input type="range" name="durationWeeks" min="2" max="12" value="4" class="range-slider" id="durationSlider" oninput="updateSliderValue('duration')" />
                    <div class="flex justify-between items-center mt-3">
                      <span class="text-[#EEEEEE]/50 text-xs">2 hét</span>
                      <span class="text-[#76ABAE] font-bold text-lg" id="durationValue">4 hét</span>
                      <span class="text-[#EEEEEE]/50 text-xs">12 hét</span>
                    </div>
                  </div>
                </div>
                
                <div>
                  <label class="block text-[#EEEEEE]/80 text-sm font-semibold mb-3">Edzésnapok hetente</label>
                  <div class="glass-card-light rounded-xl p-4">
                    <input type="range" name="daysPerWeek" min="2" max="6" value="3" class="range-slider" id="daysSlider" oninput="updateSliderValue('days')" />
                    <div class="flex justify-between items-center mt-3">
                      <span class="text-[#EEEEEE]/50 text-xs">2 nap</span>
                      <span class="text-[#76ABAE] font-bold text-lg" id="daysValue">3 nap</span>
                      <span class="text-[#EEEEEE]/50 text-xs">6 nap</span>
                    </div>
                  </div>
                </div>
                
                <div>
                  <label class="block text-[#EEEEEE]/80 text-sm font-semibold mb-3">Edzés időtartama</label>
                  <div class="glass-card-light rounded-xl p-4">
                    <input type="range" name="sessionDuration" min="20" max="90" value="45" step="5" class="range-slider" id="durationMinSlider" oninput="updateSliderValue('durationMin')" />
                    <div class="flex justify-between items-center mt-3">
                      <span class="text-[#EEEEEE]/50 text-xs">20 perc</span>
                      <span class="text-[#76ABAE] font-bold text-lg" id="durationMinValue">45 perc</span>
                      <span class="text-[#EEEEEE]/50 text-xs">90 perc</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-8">
                <label class="block text-[#EEEEEE]/80 text-sm font-semibold mb-3 flex items-center gap-2">
                  <svg class="w-6 h-6 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                  Van valami, amit tudnunk kell?
                  <span class="text-xs text-[#EEEEEE]/50 font-normal">(opcionális)</span>
                </label>
                <textarea 
                  name="additionalNotes" 
                  rows="3" 
                  class="w-full glass-input rounded-xl px-4 py-3 text-white placeholder-[#EEEEEE]/40 focus:outline-none resize-none"
                  placeholder="Pl. sérülések, korlátozások, preferenciák, speciális igények..."
                ></textarea>
              </div>

              <!-- Összefoglaló -->
              <div class="glass-card-light rounded-xl p-5 mb-6">
                <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                  <svg class="w-5 h-5 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  Edzésterved összefoglalója
                </h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm">
                  <div>
                    <span class="text-[#EEEEEE]/50 block">Cél</span>
                    <span class="text-white font-semibold" id="summaryGoal">-</span>
                  </div>
                  <div>
                    <span class="text-[#EEEEEE]/50 block">Szint</span>
                    <span class="text-white font-semibold" id="summaryLevel">-</span>
                  </div>
                  <div>
                    <span class="text-[#EEEEEE]/50 block">Helyszín</span>
                    <span class="text-white font-semibold" id="summaryLocation">-</span>
                  </div>
                  <div>
                    <span class="text-[#EEEEEE]/50 block">Összes edzés</span>
                    <span class="text-[#76ABAE] font-bold" id="summaryTotal">12 edzés</span>
                  </div>
                </div>
              </div>

              <div class="flex gap-3">
                <button type="button" onclick="prevStep(2)" class="flex-1 py-4 rounded-xl glass-card-light text-white font-bold text-lg transition-all flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                  </svg>
                  Vissza
                </button>
                <button type="submit" class="flex-[2] py-4 rounded-xl bg-gradient-to-r from-[#76ABAE] to-[#5a8a8d] hover:from-[#76ABAE]/90 hover:to-[#5a8a8d]/90 text-white font-bold text-lg transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  Edzésterv Generálása
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Jobb oldal: Korábbi tervek -->
      <div class="lg:col-span-1">
        <div class="glass-card rounded-2xl p-6">
          <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-[#76ABAE]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            Korábbi edzésterveid
          </h3>
          
          <% if (userPlans && userPlans.length > 0) { %>
            <div class="space-y-3">
              <% userPlans.forEach(plan => { %>
              <a href="/plans/view/<%= plan.id %>" class="plan-card glass-card-light rounded-xl p-4 block hover:border-[#76ABAE]/30">
                <div class="flex items-start justify-between mb-2">
                  <h4 class="text-white font-semibold text-sm line-clamp-1"><%= plan.plan_name %></h4>
                  <span class="text-[10px] px-2 py-1 rounded-full bg-[#76ABAE]/20 text-[#76ABAE] whitespace-nowrap ml-2">
                    <%= plan.duration_weeks %> hét
                  </span>
                </div>
                <div class="flex items-center gap-2 text-xs text-[#EEEEEE]/60">
                  <span><%= plan.goal_name || 'Általános' %></span>
                  <span>•</span>
                  <span><%= plan.level_name || 'Kezdő' %></span>
                </div>
                <div class="text-[10px] text-[#EEEEEE]/40 mt-2">
                  <%= new Date(plan.created_at).toLocaleDateString('hu-HU') %>
                </div>
              </a>
              <% }); %>
            </div>
          <% } else { %>
            <div class="text-center py-8">
              <div class="w-16 h-16 rounded-full bg-[#76ABAE]/10 flex items-center justify-center mx-auto mb-3">
                <svg class="w-8 h-8 text-[#76ABAE]/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
              </div>
              <p class="text-[#EEEEEE]/50 text-sm">Még nincs edzésterved</p>
              <p class="text-[#EEEEEE]/30 text-xs mt-1">Generálj egyet a bal oldali űrlappal!</p>
            </div>
          <% } %>
        </div>

        <!-- Info doboz -->
        <div class="glass-card rounded-2xl p-6 mt-6">
          <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
            Tudtad?
          </h3>
          <ul class="space-y-3 text-sm text-[#EEEEEE]/70">
            <li class="flex items-start gap-2">
              <svg class="w-5 h-5 text-[#76ABAE] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Az edzéstervek progresszíven nehezednek hétről hétre
            </li>
            <li class="flex items-start gap-2">
              <svg class="w-5 h-5 text-[#76ABAE] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Minden edzés tartalmaz bemelegítést és levezetést
            </li>
            <li class="flex items-start gap-2">
              <svg class="w-5 h-5 text-[#76ABAE] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              A lépésszámod alapján személyre szabott célokat kapsz
            </li>
            <li class="flex items-start gap-2">
              <svg class="w-5 h-5 text-[#76ABAE] flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Bármikor generálhatsz új tervet más paraméterekkel
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</main>

<%- include('../footer/footer') %>

<script>
  // Globális változók
  let currentStep = 1;
  const goalsData = <%- JSON.stringify(goals) %>;
  const levelsData = <%- JSON.stringify(fitnessLevels) %>;
  const locationsData = <%- JSON.stringify(locations) %>;

  // Slider értékek frissítése
  function updateSliderValue(type) {
    if (type === 'duration') {
      const val = document.getElementById('durationSlider').value;
      document.getElementById('durationValue').textContent = val + ' hét';
    } else if (type === 'days') {
      const val = document.getElementById('daysSlider').value;
      document.getElementById('daysValue').textContent = val + ' nap';
    } else if (type === 'durationMin') {
      const val = document.getElementById('durationMinSlider').value;
      document.getElementById('durationMinValue').textContent = val + ' perc';
    }
    updateSummary();
  }

  // Lépések közötti navigáció
  function nextStep(step) {
    document.getElementById('step' + currentStep).classList.remove('active');
    document.getElementById('step' + step).classList.add('active');
    updateStepIndicators(step);
    currentStep = step;
    updateSummary();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function prevStep(step) {
    document.getElementById('step' + currentStep).classList.remove('active');
    document.getElementById('step' + step).classList.add('active');
    updateStepIndicators(step);
    currentStep = step;
  }

  function updateStepIndicators(step) {
    for (let i = 1; i <= 3; i++) {
      const indicator = document.getElementById('step' + i + 'Indicator');
      indicator.classList.remove('active', 'completed');
      indicator.classList.add('text-[#EEEEEE]/50');
      
      if (i < step) {
        indicator.classList.add('completed');
        indicator.classList.remove('text-[#EEEEEE]/50');
        indicator.innerHTML = '✓';
      } else if (i === step) {
        indicator.classList.add('active');
        indicator.classList.remove('text-[#EEEEEE]/50');
        indicator.innerHTML = i;
      } else {
        indicator.innerHTML = i;
      }
    }

    const labels = ['1/3 - Cél kiválasztása', '2/3 - Helyszín és eszközök', '3/3 - Időkeret'];
    document.getElementById('stepLabel').textContent = labels[step - 1];
  }

  // Összefoglaló frissítése
  function updateSummary() {
    const goalId = document.querySelector('input[name="goalId"]:checked')?.value;
    const levelId = document.querySelector('input[name="fitnessLevelId"]:checked')?.value;
    const locationId = document.querySelector('input[name="locationId"]:checked')?.value;
    const weeks = document.getElementById('durationSlider')?.value || 4;
    const days = document.getElementById('daysSlider')?.value || 3;

    const goal = goalsData.find(g => g.id == goalId);
    const level = levelsData.find(l => l.id == levelId);
    const location = locationsData.find(l => l.id == locationId);

    document.getElementById('summaryGoal').textContent = goal?.name || '-';
    document.getElementById('summaryLevel').textContent = level?.name || '-';
    document.getElementById('summaryLocation').textContent = location?.name || '-';
    document.getElementById('summaryTotal').textContent = (weeks * days) + ' edzés';
  }

  // Option card kiválasztás kezelése
  document.querySelectorAll('.option-card').forEach(card => {
    card.addEventListener('click', function() {
      const input = this.querySelector('input[type="radio"]');
      if (input) {
        const name = input.name;
        document.querySelectorAll(`input[name="${name}"]`).forEach(i => {
          i.closest('.option-card').classList.remove('selected');
        });
        this.classList.add('selected');
        input.checked = true;
        updateSummary();
      }
    });
  });

  // Equipment chip kiválasztás kezelése
  document.querySelectorAll('.equipment-chip').forEach(chip => {
    chip.addEventListener('click', function() {
      const input = this.querySelector('input[type="checkbox"]');
      if (input) {
        input.checked = !input.checked;
        this.classList.toggle('selected', input.checked);
      }
    });
  });

  // Első kiválasztott opciók megjelölése
  document.querySelectorAll('input[type="radio"]:checked').forEach(input => {
    const card = input.closest('.option-card');
    if (card) card.classList.add('selected');
  });

  // Form beküldés
  document.getElementById('workoutForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = {
      goalId: formData.get('goalId'),
      fitnessLevelId: formData.get('fitnessLevelId'),
      locationId: formData.get('locationId'),
      equipmentIds: formData.getAll('equipmentIds[]').map(Number),
      durationWeeks: formData.get('durationWeeks'),
      daysPerWeek: formData.get('daysPerWeek'),
      sessionDuration: formData.get('sessionDuration'),
      additionalNotes: formData.get('additionalNotes')
    };

    // Overlay megjelenítése
    document.getElementById('generatingOverlay').classList.add('active');

    try {
      const response = await fetch('/plans/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (result.success) {
        window.location.href = result.redirectUrl;
      } else {
        document.getElementById('generatingOverlay').classList.remove('active');
        alert('Hiba történt: ' + (result.error || 'Ismeretlen hiba'));
      }
    } catch (error) {
      document.getElementById('generatingOverlay').classList.remove('active');
      alert('Hiba történt az edzésterv generálása során. Kérlek próbáld újra!');
      console.error(error);
    }
  });

  // Inicializálás
  updateSummary();
</script>
</body>
</html>
